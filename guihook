-- Remote Scanner + Tester (Final + Search Bar)
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- GUI
local gui = Instance.new("ScreenGui", game:GetService("CoreGui"))
gui.Name = "RemoteScanner"

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 400, 0, 320)
frame.Position = UDim2.new(0.25,0,0.25,0)
frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
frame.Active = true
frame.Draggable = true

local title = Instance.new("TextLabel", frame)
title.Size = UDim2.new(1,0,0,25)
title.BackgroundColor3 = Color3.fromRGB(40,40,40)
title.Text = "ðŸ”Ž Remote Scanner"
title.TextColor3 = Color3.fromRGB(0,255,0)
title.TextSize = 14

-- Minimize button
local minimizeBtn = Instance.new("TextButton", frame)
minimizeBtn.Size = UDim2.new(0,25,0,25)
minimizeBtn.Position = UDim2.new(1,-25,0,0)
minimizeBtn.Text = "-"
minimizeBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
minimizeBtn.TextColor3 = Color3.fromRGB(255,255,255)

local minimized = false

-- Search bar
local searchBox = Instance.new("TextBox", frame)
searchBox.Size = UDim2.new(1,-10,0,25)
searchBox.Position = UDim2.new(0,5,0,30)
searchBox.PlaceholderText = "ðŸ” Search..."
searchBox.Text = ""
searchBox.BackgroundColor3 = Color3.fromRGB(35,35,35)
searchBox.TextColor3 = Color3.fromRGB(255,255,255)
searchBox.ClearTextOnFocus = false

local scroll = Instance.new("ScrollingFrame", frame)
scroll.Size = UDim2.new(1,0,1,-100)
scroll.Position = UDim2.new(0,0,0,60)
scroll.CanvasSize = UDim2.new(0,0,0,0)
scroll.ScrollBarThickness = 6

local layout = Instance.new("UIListLayout", scroll)
layout.Padding = UDim.new(0,2)

local clearBtn = Instance.new("TextButton", frame)
clearBtn.Size = UDim2.new(0.33,0,0,25)
clearBtn.Position = UDim2.new(0,0,1,-30)
clearBtn.Text = "ðŸ—‘ï¸ Clear"
clearBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
clearBtn.TextColor3 = Color3.fromRGB(255,255,255)

local refreshBtn = Instance.new("TextButton", frame)
refreshBtn.Size = UDim2.new(0.34,0,0,25)
refreshBtn.Position = UDim2.new(0.33,0,1,-30)
refreshBtn.Text = "ðŸ”„ Rescan"
refreshBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
refreshBtn.TextColor3 = Color3.fromRGB(255,255,255)

local copyAllBtn = Instance.new("TextButton", frame)
copyAllBtn.Size = UDim2.new(0.33,0,0,25)
copyAllBtn.Position = UDim2.new(0.67,0,1,-30)
copyAllBtn.Text = "ðŸ“‹ Copy All"
copyAllBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
copyAllBtn.TextColor3 = Color3.fromRGB(255,255,255)

-- Log system
local allRemotes = {}
local remotesList = {}

local function AddLog(msg)
    local log = Instance.new("TextButton")
    log.Size = UDim2.new(1,-4,0,20)
    log.TextXAlignment = Enum.TextXAlignment.Left
    log.BackgroundColor3 = Color3.fromRGB(35,35,35)
    log.Text = msg
    log.TextColor3 = Color3.fromRGB(220,220,220)
    log.TextSize = 12
    log.Parent = scroll

    table.insert(remotesList, {path = msg, button = log})

    -- Copy path
    log.MouseButton1Click:Connect(function()
        setclipboard(msg)
        warn("Copied remote path: "..msg)
    end)

    -- Test remote
    log.MouseButton2Click:Connect(function()
        local remote = game
        for part in string.gmatch(msg, "[^%.]+") do
            remote = remote:FindFirstChild(part)
            if not remote then break end
        end
        if remote then
            if remote:IsA("RemoteEvent") then
                remote:FireServer("TestArg")
                warn("Test FireServer:", remote.Name)
            elseif remote:IsA("RemoteFunction") then
                local ok, res = pcall(function()
                    return remote:InvokeServer("TestArg")
                end)
                warn("Test InvokeServer:", remote.Name, ok, res)
            end
        end
    end)
end

-- Scanner
local function ScanRemotes()
    for _,v in pairs(scroll:GetChildren()) do
        if v:IsA("TextButton") then v:Destroy() end
    end
    table.clear(remotesList)
    table.clear(allRemotes)

    for _,v in ipairs(game:GetDescendants()) do
        if v:IsA("RemoteEvent") or v:IsA("RemoteFunction") then
            AddLog(v:GetFullName())
            table.insert(allRemotes, v:GetFullName())
        end
    end
    scroll.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y)
end

-- Search filter
local function FilterRemotes(query)
    for _,item in pairs(remotesList) do
        if string.find(string.lower(item.path), string.lower(query)) then
            item.button.Visible = true
        else
            item.button.Visible = false
        end
    end
    scroll.CanvasSize = UDim2.new(0,0,0,layout.AbsoluteContentSize.Y)
end

searchBox:GetPropertyChangedSignal("Text"):Connect(function()
    FilterRemotes(searchBox.Text)
end)

-- Buttons
clearBtn.MouseButton1Click:Connect(function()
    for _,v in pairs(scroll:GetChildren()) do
        if v:IsA("TextButton") then v:Destroy() end
    end
    table.clear(remotesList)
    table.clear(allRemotes)
end)

refreshBtn.MouseButton1Click:Connect(ScanRemotes)

copyAllBtn.MouseButton1Click:Connect(function()
    if #allRemotes > 0 then
        setclipboard(table.concat(allRemotes, "\n"))
        warn("Copied all remotes to clipboard.")
    end
end)

minimizeBtn.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        scroll.Visible = false
        searchBox.Visible = false
        clearBtn.Visible = false
        refreshBtn.Visible = false
        copyAllBtn.Visible = false
        frame.Size = UDim2.new(0,200,0,25)
        minimizeBtn.Text = "+"
    else
        scroll.Visible = true
        searchBox.Visible = true
        clearBtn.Visible = true
        refreshBtn.Visible = true
        copyAllBtn.Visible = true
        frame.Size = UDim2.new(0,400,0,320)
        minimizeBtn.Text = "-"
    end
end)

-- Start
ScanRemotes()
