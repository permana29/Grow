--// Net Hook (Light) with Optional Aggressive Layer
--// by Permana

--=== SETTINGS ===--
local MAX_LOGS = 200 -- batasi biar gak berat
local USE_AGGRESSIVE = false -- bisa diubah via toggle di UI

--=== Services ===--
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")

--=== GUI ===--
local SG = Instance.new("ScreenGui")
SG.Name = "Permana_NetHook"
SG.ResetOnSpawn = false
SG.Parent = CoreGui

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 360, 0, 230)
Frame.Position = UDim2.new(0.3, 0, 0.3, 0)
Frame.BackgroundColor3 = Color3.fromRGB(25,25,25)
Frame.Active = true
Frame.Draggable = true
Frame.Parent = SG

local Stroke = Instance.new("UIStroke", Frame)
Stroke.Color = Color3.fromRGB(0, 200, 255)
Stroke.Thickness = 1.5

local Corner = Instance.new("UICorner", Frame)
Corner.CornerRadius = UDim.new(0,10)

local Top = Instance.new("Frame")
Top.Size = UDim2.new(1,0,0,34)
Top.BackgroundColor3 = Color3.fromRGB(35,35,35)
Top.Parent = Frame
Instance.new("UICorner", Top).CornerRadius = UDim.new(0,10)

local Title = Instance.new("TextLabel")
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0,12,0,0)
Title.Size = UDim2.new(1,-120,1,0)
Title.Font = Enum.Font.GothamBold
Title.Text = "📡 Net Hook (Light)"
Title.TextColor3 = Color3.fromRGB(0,255,0)
Title.TextSize = 16
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Top

local ToggleAgg = Instance.new("TextButton")
ToggleAgg.Size = UDim2.new(0, 110, 0, 24)
ToggleAgg.Position = UDim2.new(1, -150, 0.5, -12)
ToggleAgg.BackgroundColor3 = Color3.fromRGB(55,55,55)
ToggleAgg.TextColor3 = Color3.fromRGB(255,255,255)
ToggleAgg.Font = Enum.Font.GothamBold
ToggleAgg.TextSize = 12
ToggleAgg.Text = "Aggressive: OFF"
ToggleAgg.Parent = Top
Instance.new("UICorner", ToggleAgg).CornerRadius = UDim.new(0,6)

local MinBtn = Instance.new("TextButton")
MinBtn.Size = UDim2.new(0, 28, 0, 24)
MinBtn.Position = UDim2.new(1, -36, 0.5, -12)
MinBtn.BackgroundColor3 = Color3.fromRGB(70,70,70)
MinBtn.TextColor3 = Color3.fromRGB(255,255,255)
MinBtn.Font = Enum.Font.GothamBold
MinBtn.TextSize = 16
MinBtn.Text = "-"
MinBtn.Parent = Top
Instance.new("UICorner", MinBtn).CornerRadius = UDim.new(0,6)

local Body = Instance.new("Frame")
Body.BackgroundColor3 = Color3.fromRGB(20,20,20)
Body.Size = UDim2.new(1, -16, 1, -78)
Body.Position = UDim2.new(0,8,0,42)
Body.Parent = Frame
Instance.new("UICorner", Body).CornerRadius = UDim.new(0,8)

local LogList = Instance.new("ScrollingFrame")
LogList.Size = UDim2.new(1, -10, 1, -10)
LogList.Position = UDim2.new(0,5,0,5)
LogList.BackgroundTransparency = 1
LogList.BorderSizePixel = 0
LogList.CanvasSize = UDim2.new()
LogList.ScrollBarThickness = 6
LogList.Parent = Body

local UIL = Instance.new("UIListLayout")
UIL.Parent = LogList
UIL.Padding = UDim.new(0,4)
UIL.SortOrder = Enum.SortOrder.LayoutOrder

local Bottom = Instance.new("Frame")
Bottom.Size = UDim2.new(1, -16, 0, 30)
Bottom.Position = UDim2.new(0,8,1,-38)
Bottom.BackgroundColor3 = Color3.fromRGB(35,35,35)
Bottom.Parent = Frame
Instance.new("UICorner", Bottom).CornerRadius = UDim.new(0,8)

local ClearBtn = Instance.new("TextButton")
ClearBtn.Size = UDim2.new(1, -10, 1, -6)
ClearBtn.Position = UDim2.new(0,5,0,3)
ClearBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
ClearBtn.TextColor3 = Color3.fromRGB(255,255,255)
ClearBtn.Font = Enum.Font.GothamBold
ClearBtn.TextSize = 14
ClearBtn.Text = "🗑️  Clear Logs"
ClearBtn.Parent = Bottom
Instance.new("UICorner", ClearBtn).CornerRadius = UDim.new(0,6)

-- Minimize logic
local minimized = false
local function layout()
	if minimized then
		Body.Visible = false
		Bottom.Visible = false
		Frame.Size = UDim2.new(0,360,0,40)
		MinBtn.Text = "+"
	else
		Body.Visible = true
		Bottom.Visible = true
		Frame.Size = UDim2.new(0,360,0,230)
		MinBtn.Text = "-"
	end
end
MinBtn.MouseButton1Click:Connect(function() minimized = not minimized; layout() end)
layout()

-- Clear logs
local function clearLogs()
	for _,v in ipairs(LogList:GetChildren()) do
		if v:IsA("TextButton") then v:Destroy() end
	end
	LogList.CanvasSize = UDim2.new()
end
ClearBtn.MouseButton1Click:Connect(clearLogs)

-- Add log entry
local logCount = 0
local function addLog(remote, method, args)
	-- Guard
	if not remote or not remote.Name then return end
	logCount += 1
	if logCount > MAX_LOGS then clearLogs(); logCount = 1 end

	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(1, 0, 0, 22)
	btn.BackgroundColor3 = (method == "FireServer") and Color3.fromRGB(40,60,40) or Color3.fromRGB(60,40,40)
	btn.TextColor3 = Color3.fromRGB(230,230,230)
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 13
	btn.TextXAlignment = Enum.TextXAlignment.Left
	btn.AutoButtonColor = true
	btn.Text = string.format("[%s] %s", method, remote:GetFullName())
	btn.Parent = LogList
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0,4)

	local encoded = "[]"
	pcall(function() encoded = HttpService:JSONEncode(args) end)

	btn.MouseButton1Click:Connect(function()
		if setclipboard then
			setclipboard(encoded)
			btn.Text = btn.Text .. "  (copied)"
			task.delay(0.6, function()
				btn.Text = string.format("[%s] %s", method, remote:GetFullName())
			end)
		end
	end)

	LogList.CanvasSize = UDim2.new(0,0,0, UIL.AbsoluteContentSize.Y + 10)
end

--=== HOOKS ===--

-- Light hook: hookmetamethod only (paling aman & ringan)
local oldNamecall
oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
	local method = getnamecallmethod()
	if not checkcaller() and (method == "FireServer" or method == "InvokeServer") then
		if self and (self:IsA("RemoteEvent") or self:IsA("RemoteFunction")) then
			addLog(self, method, {...})
		end
	end
	return oldNamecall(self, ...)
end)

-- Aggressive layer (opsional)
local oldFireServer, oldInvokeServer
local function enableAggressive(on)
	if on then
		if not oldFireServer then
			oldFireServer = hookfunction(getrenv().Instance.new("RemoteEvent").FireServer, function(self, ...)
				addLog(self, "FireServer", {...})
				return oldFireServer(self, ...)
			end)
		end
		if not oldInvokeServer then
			oldInvokeServer = hookfunction(getrenv().Instance.new("RemoteFunction").InvokeServer, function(self, ...)
				addLog(self, "InvokeServer", {...})
				return oldInvokeServer(self, ...)
			end)
		end
	else
		-- tidak bisa unhook cleanly di sebagian executor; biarkan saja OFF dengan flag
	end
end

-- Toggle aggressive via UI
ToggleAgg.MouseButton1Click:Connect(function()
	USE_AGGRESSIVE = not USE_AGGRESSIVE
	ToggleAgg.Text = "Aggressive: " .. (USE_AGGRESSIVE and "ON" or "OFF")
	if USE_AGGRESSIVE then enableAggressive(true) end
end)

-- Info awal
addLog({Name="NetHook Ready", GetFullName=function() return "NetHook ▶ Waiting…" end}, "Info", {})
